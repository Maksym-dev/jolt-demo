<!DOCTYPE html>
<html>
<head>
    <title>Jolt Transform Demo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="http://code.jquery.com/jquery-2.0.3.min.js"></script>


<!-- Use the cdn hosted bootstrap -->

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" media="screen" href="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css">

    <!-- Optional theme -->
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-theme.min.css">

    <!-- Latest compiled and minified JavaScript -->
    <script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>

    <script type="text/javascript">

        function parseJson( json ) {
            try {
                var theJson = jQuery.parseJSON( json );
                return theJson;
            }
            catch (e) {
                return false;
            }
        }

    </script>

</head>
<body>

<div class="container">

<h1>Jolt Transform Demo</h1>

Here you can experiment with the Jolt Transforms without having to download and run the Java code.

<form id="transformForm" role="form" action="/transform" method="post">

    <div id="inputPanel" class="panel panel-default">
        <div class="panel-heading">
            <label for="input">Json Input</label>
            <button type="button" id="inputValidateButton" class="btn btn-default">Validate Json</button>
        </div>
        <div class="panel-body">
            <textarea form="transformForm" class="form-control" name="input" id="input" rows="20">
                {
                    "rating": {
                        "primary": {
                            "value": 5
                        },
                        "quality": {
                            "value": 4
                        }
                    }
                }
            </textarea>
        </div>
    </div>


    <div id="specPanel" class="panel panel-default">
        <div class="panel-heading">
            <label for="spec">Jolt Spec</label>
            <button type="button" id="specValidateButton" class="btn btn-default">Validate Json</button>
        </div>
        <div class="panel-body">
            <textarea form="transformForm" class="form-control" id="spec" rows="20">
                [
                {
                "operation": "shift",
                "spec": {
                "rating": {
                "primary": {
                "value": "Rating"
                },
                "*": {
                "value": "SecondaryRatings.&1.Value",
                "$": "SecondaryRatings.&.Id"
                }
                }
                }
                },
                {
                "operation": "default",
                "spec": {
                "Range" : 5,
                "SecondaryRatings" : {
                "*" : {
                "Range" : 5
                }
                }
                }
                }
                ]

            </textarea>
        </div>
    </div>

    <button id="processButton" name="processButton" type="submit" class="btn btn-default">Transform</button>

    <div id="outputPanel" class="panel panel-default">
        <div class="panel-heading">
            <label for="outputJson">Transformed Json / Error Messages </label>
        </div>
        <div class="panel-body">
            <textarea form="transformForm" class="form-control" id="outputJson" rows="20">
            </textarea>
        </div>
    </div>

</form>

</div>  <!-- / container -->


<!-- Script at the bottom so that we know that html elements have been loaded. -->
<script type="text/javascript">

function validateInput() {

    var inputTextArea = $( "#input" );
    var inputPanel = $("#inputPanel");
    var theJson = parseJson( inputTextArea.val() );
    if ( theJson ) {
        inputPanel.toggleClass("panel-danger", false);
        inputTextArea.val( JSON.stringify( theJson, null, '    ' ) );
        return true;
    }
    else {
        inputPanel.toggleClass("panel-danger", true);
        return false;
    }
}

$("#inputValidateButton").click( validateInput );

function validateSpec() {

    var specTextArea = $( "#spec" );
    var specPanel = $("#specPanel");

    var theJson = parseJson( specTextArea.val() );
    if ( theJson ) {
        specPanel.toggleClass("panel-danger", false);
        specTextArea.val( JSON.stringify( theJson, null, '    ' ) );
        return true;
    }
    else {
        specPanel.toggleClass("panel-danger", true);
    }
    return false;
}

$("#specValidateButton").click( validateSpec );

/*
 * Attach a submit handler to the form.
 * The form should still theoretically work even w/out JavaScript.
 */
$("#transformForm").submit(function(event) {

    var inputValid = validateInput();
    var specValid = validateSpec();
    if ( ! inputValid || ! specValid ) {
        $( "#outputJson" ).val( "Problem with input or spec JSON." );

        // return false so that we prevent the standard form submit behavior from happening
        return false;
    }

    // get some values from elements on the page:
    var $form = $( this ),
            input = $form.find( '#input' ).val(),
            spec  = $form.find( '#spec' ).val(),
            url   = $form.attr( 'action' );

    // Send the data using post
    var posting = $.post( url, { input : input, spec : spec } );

    // Put the results in a div
    posting.done(function( data ) {
        var content = data ;
        $( "#outputJson" ).val( content );
    });

    // return false so that we prevent the standard form submit behavior from happening
    return false;
});


</script>

</body>
</html>
